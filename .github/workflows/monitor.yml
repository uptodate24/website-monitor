name: Website Health Monitor
# Monitor for Mentari UNPAM - Updated for scheduled runs
on:
  schedule:
    - cron: '*/5 * * * *'  # Setiap 5 menit
  workflow_dispatch:        # Bisa run manual

jobs:
  monitor:
    runs-on: ubuntu-latest
    steps:
    - name: Check Mentari UNPAM
      run: |
        STATUS_CODE=$(curl -s -o /dev/null -w "%{http_code}" "https://mentari.unpam.ac.id/" --connect-timeout 10 --max-time 10)
        echo "Status Code: $STATUS_CODE"
        
        # Simpan status sebelumnya
        PREV_STATUS=$(cat status.txt 2>/dev/null || echo "UNKNOWN")
        echo "Previous Status: $PREV_STATUS"
        
        # Kirim notifikasi jika status berubah
        if [ "$STATUS_CODE" -eq 200 ] && [ "$PREV_STATUS" != "UP" ]; then
          echo "ðŸŸ¢ Website BACK UP - Sending notification..."
          curl -X POST \
            -H "Content-Type: application/json" \
            -d "{\"content\":\"ðŸŸ¢ **MENTARI UNPAM BACK UP**\\nURL: https://mentari.unpam.ac.id/\\nStatus: $STATUS_CODE\\nTime: $(date -u)\"}" \
            "${{ secrets.DISCORD_WEBHOOK }}"
          echo "UP" > status.txt
          
        elif [ "$STATUS_CODE" -ne 200 ] && [ "$PREV_STATUS" != "DOWN" ]; then
          echo "ðŸ”´ Website DOWN - Sending notification..."
          curl -X POST \
            -H "Content-Type: application/json" \
            -d "{\"content\":\"ðŸ”´ **MENTARI UNPAM DOWN**\\nURL: https://mentari.unpam.ac.id/\\nStatus: $STATUS_CODE\\nTime: $(date -u)\"}" \
            "${{ secrets.DISCORD_WEBHOOK }}"
          echo "DOWN" > status.txt
        else
          echo "âœ… Status unchanged - No notification needed"
        fi
